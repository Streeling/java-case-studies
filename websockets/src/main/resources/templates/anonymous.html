<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Getting Started: Serving Web Content</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
<p th:text="'Status: '" />
<form>
  <input type="button" value="Connect"/>
</form>

<script src="/js/jquery-3.5.1.js" type="text/javascript"></script>
<script src="/js/sockjs.min.js" type="text/javascript"></script>
<script src="/js/stomp.min.js" type="text/javascript" th:inline="javascript"></script>
<script>
  $(function() {
    $("input[type=button]").click(function() {
      var socket = new SockJS('http://localhost:8080/gs-guide-websocket');
      var stompClient = Stomp.over(socket);

      var headerName = "[[${_csrf.headerName}]]";
      var token = "[[${_csrf.token}]]";
      var headers = {};
      headers[headerName] = token;

      stompClient.connect(headers, function () {alert(socket._transport.url);
        // stompClient.subscribe('/user/topic/greetings', function (response) {
        stompClient.subscribe('/topic/messages.user.123', function (response) {
          console.log('Got ' + response);
          $( "p" ).text( "Status: " + JSON.parse(response.body).text );
        });
        console.info('connected!')
      });
    });
  });
</script>
</body>
</html>
