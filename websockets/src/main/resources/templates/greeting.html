<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>Getting Started: Serving Web Content</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
    <p th:text="'Status: '" />
    <form>
        <button>Start</button>
    </form>

    <script src="/js/jquery-3.5.1.js" type="text/javascript"></script>
    <script src="/js/sockjs.min.js" type="text/javascript"></script>
    <script src="/js/stomp.min.js" type="text/javascript"></script>
    <script>
        $(function() {
            var socket = new SockJS('http://localhost:8080/gs-guide-websocket');
            var stompClient = Stomp.over(socket);

            stompClient.connect({}, function () {
                // stompClient.subscribe('/user/topic/greetings', function (response) {
                stompClient.subscribe('/topic/greetings', function (response) {
                    console.log('Got ' + response);
                    $( "p" ).text( "Status: " + JSON.parse(response.body).text );
                });
                console.info('connected!')
            });
            // var exampleSocket = new WebSocket("wss://localhost:8080/gs-guide-websocket/topic/greetings");
            // var exampleSocket = new WebSocket("ws://localhost:8080/gs-guide-websocket");
            //
            // exampleSocket.onopen = function(){
            //     ws.send(JSON.stringify({"command": "subscribe","identifier":"{\"channel\":\"topic/greetings\"}"}))
            // }
            //
            // exampleSocket.onerror = function(event) {
            //     console.error('WebSocket error', event);
            // };
            //
            // exampleSocket.onmessage = function(event) {
            //     var msg = JSON.parse(event.data);
            //     $( "p" ).text( "Status: " + msg );
            // };
        });
    </script>
</body>
</html>
